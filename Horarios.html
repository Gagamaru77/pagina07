<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Horarios y Reservas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="https://www.pngkey.com/png/full/642-6421502_quote-calculator-ns-logo.png" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding-top: 56px;
      background-image: url('https://images.unsplash.com/photo-1503264116251-35a269479413?auto=format&fit=crop&w=1470&q=80');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      min-height: 100vh;
    }
    .card li::before { content: "🟢"; margin-right: 8px; }
    .card li:last-child::before { content: "🔴"; }
    .card {
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      padding: 30px 25px;
      margin: 20px auto;
    }
    .status-open { color: green; font-weight: bold; }
    .status-closed { color: red; font-weight: bold; }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg bg-primary fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand text-white" href="index.html">Net_Service</a>
  </div>
</nav>

<!-- Contenido -->
<div class="container mt-4">
  <ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="horarios-tab" data-bs-toggle="tab" data-bs-target="#horarios" type="button" role="tab">Horarios</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="reservas-tab" data-bs-toggle="tab" data-bs-target="#reservas" type="button" role="tab">Reservar</button>
    </li>
  </ul>
  <div class="tab-content p-3" id="myTabContent">

    <!-- Horarios -->
    <div class="tab-pane fade show active" id="horarios" role="tabpanel">
      <div class="card" style="max-width:500px;">
        <h2 class="text-center">🕒 Horario de Atención</h2>
        <ul>
          <li><strong>Lunes a Viernes:</strong> 9:00 a.m. – 1:00 p.m. / 3:00 p.m. – 8:00 p.m.</li>
          <li><strong>Sábados:</strong> 9:00 a.m. – 2:00 p.m.</li>
          <li><strong>Domingos y feriados:</strong> Cerrado</li>
        </ul>
        <div class="mt-3">
          <label for="fecha">Selecciona una fecha:</label>
          <input type="date" id="fecha" class="form-control mt-2" />
          <div class="selected-date mt-2" id="selectedDateText"></div>
          <div class="selected-status mt-1" id="selectedStatusText"></div>
        </div>
      </div>
    </div>

    <!-- Reservas -->
    <div class="tab-pane fade" id="reservas" role="tabpanel">
      <div class="container py-3" style="max-width:500px;">
        <h2 class="text-center mb-4">📅 Reservar Cabina</h2>
        <form id="reservaForm" class="card p-4 shadow">
          <div class="mb-3">
            <label class="form-label">Nombre completo</label>
            <input type="text" id="nombre" class="form-control" required />
          </div>
          <div class="mb-3">
            <label class="form-label">DNI</label>
            <input type="text" id="dni" class="form-control" maxlength="8" pattern="\d{8}" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Número de WhatsApp</label>
            <input type="tel" id="whatsapp" class="form-control" pattern="\d{9,15}" placeholder="Ej: 999888777" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Fecha</label>
            <input type="date" id="fechaReserva" class="form-control" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Hora de Inicio</label>
            <input type="time" id="inicio" class="form-control" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Hora de Fin</label>
            <input type="time" id="fin" class="form-control" required />
          </div>
          <button type="submit" class="btn btn-success w-100">Reservar</button>
          <div id="resultado" class="mt-3 text-center fw-bold"></div>
        </form>
      </div>
    </div>

  </div>
</div>

<!-- Script Horarios -->
<script>
const fechaInput = document.getElementById('fecha');
const selectedDateText = document.getElementById('selectedDateText');
const selectedStatusText = document.getElementById('selectedStatusText');
const feriados = ['01-01','05-01','07-28','07-29','12-25'];

// Bloquear fechas pasadas
const hoy = new Date();
const yyyy = hoy.getFullYear();
const mm = String(hoy.getMonth() + 1).padStart(2, '0');
const dd = String(hoy.getDate()).padStart(2, '0');
fechaInput.min = `${yyyy}-${mm}-${dd}`;

fechaInput.addEventListener('change', () => {
  const fechaSeleccionada = fechaInput.value;
  if (!fechaSeleccionada) { selectedDateText.textContent=''; selectedStatusText.textContent=''; return; }
  
  // Crear fecha local sin desfase UTC
  const partes = fechaSeleccionada.split('-');
  const fecha = new Date(partes[0], partes[1]-1, partes[2]);
  
  const opciones = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
  selectedDateText.textContent = `Has seleccionado: ${fecha.toLocaleDateString('es-ES', opciones)}`;
  
  const diaSemana = fecha.getDay();
  const mmdd = partes[1].padStart(2,'0') + '-' + partes[2].padStart(2,'0');
  const esFeriado = feriados.includes(mmdd);
  
  if (diaSemana === 0 || esFeriado) {
    selectedStatusText.textContent = '🚫 Cerrado (Domingos y feriados)';
    selectedStatusText.className = 'status-closed';
  } else if (diaSemana >= 1 && diaSemana <= 5) {
    selectedStatusText.textContent = '✅ Abierto: 9:00 a.m. – 1:00 p.m. / 3:00 p.m. – 8:00 p.m.';
    selectedStatusText.className = 'status-open';
  } else if (diaSemana === 6) {
    selectedStatusText.textContent = '✅ Abierto: 9:00 a.m. – 2:00 p.m.';
    selectedStatusText.className = 'status-open';
  }
});
</script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAbxk77pLZ-3Tagr7RUaDnTPnnZPC1BWtM",
  authDomain: "reservas-cabinas.firebaseapp.com",
  projectId: "reservas-cabinas",
  storageBucket: "reservas-cabinas.appspot.com",
  messagingSenderId: "1092073467342",
  appId: "1:1092073467342:web:68fa885afe6b3663210f9f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

document.getElementById("reservaForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const nombre = document.getElementById("nombre").value.trim();
  const dni = document.getElementById("dni").value.trim();
  const whatsapp = document.getElementById("whatsapp").value.trim();
  const fechaStr = document.getElementById("fechaReserva").value;
  const partes = fechaStr.split('-');
  const fecha = new Date(partes[0], partes[1]-1, partes[2]);
  const inicio = document.getElementById("inicio").value;
  const fin = document.getElementById("fin").value;
  const diaSemana = fecha.getDay();

  if (!fechaStr) return alert("📅 Debes seleccionar una fecha válida.");

  // No permitir fechas pasadas
  const hoySinHora = new Date(yyyy, hoy.getMonth(), hoy.getDate());
  if (fecha < hoySinHora) return alert("🚫 No puedes reservar en fechas pasadas.");

  // No permitir domingos
  if (diaSemana === 0) return alert("🚫 No se aceptan reservas los domingos.");

  // Horarios válidos
  const inicioMin = parseInt(inicio.split(":")[0])*60 + parseInt(inicio.split(":")[1]);
  const finMin = parseInt(fin.split(":")[0])*60 + parseInt(fin.split(":")[1]);
  let valido = false;

  if (diaSemana >= 1 && diaSemana <= 5) {
    if ((inicioMin >= 540 && finMin <= 780) || (inicioMin >= 900 && finMin <= 1200)) valido = true;
  } else if (diaSemana === 6) {
    if (inicioMin >= 540 && finMin <= 840) valido = true;
  }

  if (!valido) return alert("⏰ El horario no está dentro del horario de atención permitido.");

  try {
    await db.collection("reservas").add({ nombre, dni, whatsapp, fecha: fechaStr, inicio, fin });
    document.getElementById("resultado").textContent = "✅ Reserva guardada con éxito.";
    document.getElementById("resultado").className = "mt-3 text-center fw-bold text-success";
    e.target.reset();
  } catch (error) {
    document.getElementById("resultado").textContent = "❌ Error al guardar la reserva.";
    document.getElementById("resultado").className = "mt-3 text-center fw-bold text-danger";
  }
});
</script>

</body>
</html>
